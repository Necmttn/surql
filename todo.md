# surql-gen CLI Tool Tasks

## High Priority

- [x] Parse SurrealQL schema to generate TypeBox types
- [x] Add basic CLI with input/output flags
- [x] Create configuration file (surql-gen.json) to store settings
  - [x] output file name
  - [x] output file path
  - [x] import path for the generated file
  - [x] import name for the generated file
- [x] Add support for different import strategies (ESM, CJS, Deno, etc.)
- [x] Support TypeScript configuration (surql-gen.config.ts) for better
      developer experience
  - [x] Add migration tool to convert from JSON to TypeScript
  - [x] Auto-detect config files in current directory

## Medium Priority

- [x] Add better CLI interface with proper help messages
- [x] Add a flag to generate typebox schemas from .surql file
- [x] Complete SurrealDB connection implementation
  - [x] Add placeholder structure
  - [x] Implement actual SurrealDB connection using Surreal.Instance()
  - [x] Parse schema information from INFO query
- [ ] Add automatic type detection improvements

## Final Steps

- [x] Add comprehensive documentation (README.md)
- [x] Add examples
  - [x] Basic user/post example
  - [ ] Add more complex examples
- [ ] Add unit tests
  - [x] Test SurrealDB connection implementation
  - [ ] Test against .surql files
  - [ ] Test against SurrealDB running in Docker
- [x] Prepare for publication to npm and deno.land/x

## Publishing

- [x] Update README with usage instructions
- [x] Add license file
- [x] Publish as CLI tool
  - [ ] Package for npm
  - [x] Publish to JSR (replaces deno.land/x)

## Debugging DB Schema Generation Issue

### Problem

- [x] DB connection schema generation creates `db.ts` file instead of using the
      configured filename `schema.ts`
- [x] The schema generated by DB connection and file processing have different
      type structures
- [x] References fields are not properly typed in DB connection output

### Steps to Debug and Fix

- [x] Check how the DB connection mode determines the output file path
- [x] Verify if there's a hardcoded output path when using direct DB connection
      vs .surql file
- [x] Compare file paths used in both file processing and DB processing
- [ ] Add validation to ensure output paths are consistent
- [x] Add clear documentation for both file and DB generation paths
- [ ] Add tests for output path validation

### Implementation

- [x] Fix the `processDB` function to exclusively use the configured output path
- [ ] Update the error handling to provide clearer messages about file paths
- [ ] Add a logging option to show exactly where files are being generated
- [ ] Create a command option to control whether existing files should be
      overwritten

### Type Handling Issues

- [x] DB connection doesn't handle `references<table>` fields correctly,
      misinterpreting them as strings
- [x] Updated `parseFieldDefinition` function to properly recognize and handle
      references types
- [x] Added specific handling for references in field object processing
- [ ] Check if array handling is consistent between file and DB processing
- [ ] Verify entity type conversion for edge cases
